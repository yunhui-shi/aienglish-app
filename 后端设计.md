å¥½çš„ï¼Œä»¥ä¸‹æ˜¯ä¸ºè¿™ä¸ª**è‹±è¯­é•¿å¥ç†è§£è®­ç»ƒç³»ç»Ÿ**è®¾è®¡çš„åç«¯æ¶æ„æ–‡æ¡£ï¼Œç›®æ ‡æ˜¯ï¼š

* æ”¯æŒé¢˜ç›®ç®¡ç†ï¼ˆåŒ…æ‹¬è¯è¯­é€‰æ‹©å’Œå¥æ„ç¿»è¯‘ï¼‰
* æ”¯æŒç”¨æˆ·æ•°æ®å­˜å‚¨ï¼ˆç”Ÿè¯æœ¬ã€é”™é¢˜æœ¬ã€ç»ƒä¹ è®°å½•ï¼‰
* æ”¯æŒæ¨èç³»ç»Ÿï¼ˆåŸºäºé”™é¢˜çš„è¯­æ³•ç‚¹æ‹“å±•ï¼‰
* ä¾¿äºæœªæ¥æ‰©å±•ä¸ºå¤šç”¨æˆ·ã€å¤šç«¯å¹³å°

---

# ğŸ—ï¸ åç«¯æ¶æ„è®¾è®¡æ–‡æ¡£

---

## ğŸ”§ æŠ€æœ¯é€‰å‹å»ºè®®

| æ¨¡å—  | æŠ€æœ¯æ¨è                                                | è¯´æ˜                         |
| --- | --------------------------------------------------- | -------------------------- |
| æ¡†æ¶  | **FastAPI** / **NestJS**                            | Python æˆ– Node åç«¯å‡å¯å¿«é€Ÿå¼€å‘ã€é«˜æ€§èƒ½ |
| æ•°æ®åº“ | **PostgreSQL**                                      | æ”¯æŒç»“æ„åŒ–æŸ¥è¯¢ï¼Œé€‚åˆé¢˜åº“ä¸ç”¨æˆ·æ•°æ®          |
| ç¼“å­˜  | **Redis**ï¼ˆå¯é€‰ï¼‰                                       | ç”¨äºåŠ é€Ÿé¢˜ç›®è¯»å– / ç”¨æˆ·æ¨èè®°å½•          |
| éƒ¨ç½²  | Docker + Gunicorn + Nginxï¼ˆæˆ– Vercel Edge + Supabaseï¼‰ | äº‘ç«¯éƒ¨ç½²å¯å¼¹æ€§ä¼¸ç¼©                  |
| æƒé™  | JWT ç”¨æˆ·é‰´æƒ                                            | ç®€å•å®‰å…¨çš„ç™»å½•ç®¡ç†æ–¹å¼                |
| è¯å…¸  | æœ¬åœ° JSON è¯å…¸ + ç¬¬ä¸‰æ–¹æ¥å£å¤‡é€‰                                | æä¾›è¯ä¹‰ç‚¹å‡»è§£é‡Šæ”¯æŒ                 |

---

## ğŸ—‚ï¸ æ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆPostgreSQLï¼‰

### 1. `users` è¡¨ï¼šç”¨æˆ·ä¿¡æ¯

| å­—æ®µ             | ç±»å‹                           | æè¿°             |
| -------------- | ------------------------------ | -------------- |
| id             | UUID (default: uuid.uuid4)     | ç”¨æˆ·å”¯ä¸€æ ‡è¯†         |
| email          | String (unique, index)         | é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰         |
| password\_hash | String                         | ç™»å½•å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰     |
| created\_at    | DateTime (timezone=True, server_default=now) | åˆ›å»ºæ—¶é—´           |
| plan           | ENUM ('free', 'premium', default='free') | å…è´¹ / ä»˜è´¹è®¡åˆ’      |

---

### 2. `sentences` è¡¨ï¼šé¢˜å¹²å¥å­

| å­—æ®µ             | ç±»å‹                                         | æè¿°                   |
| -------------- | -------------------------------------------- | -------------------- |
| id             | Integer (autoincrement)                      | å”¯ä¸€ ID                |
| text           | TEXT                                         | è‹±æ–‡å¥å­åŸæ–‡               |
| translation    | TEXT                                         | æ­£ç¡®ä¸­æ–‡ç¿»è¯‘               |
| grammar\_point | String (nullable=True)                       | å¯¹åº”è¯­æ³•ç‚¹                |
| difficulty     | ENUM ('advanced', 'medium', 'hard', default='medium') | éš¾åº¦ç­‰çº§                 |
| \_created\_by   | \_UUID (ForeignKey: users.id, nullable=True)\_ | \_ç®¡ç†å‘˜æˆ–ç³»ç»Ÿåˆ›å»ºäºº (å¯é€‰)\_ |

---

### 3. `questions` è¡¨ï¼šé¢˜ç›®

| å­—æ®µ                    | ç±»å‹                                      | æè¿°                                              |
| ----------------------- | ----------------------------------------- | ------------------------------------------------- |
| id                      | Integer (autoincrement)                   | å”¯ä¸€ ID                                           |
| sentence\_id            | Integer (ForeignKey: sentences.id)        | å¤–é”®ï¼šå…³è”å¥å­                                      |
| type                    | ENUM ('word\_choice', 'translation')     | é¢˜ç›®ç±»å‹ï¼šè¯è¯­é€‰æ‹© / ç¿»è¯‘é€‰æ‹©                           |
| options                 | JSON                                      | é€‰é¡¹ (ä¾‹å¦‚: ["option1", "option2"])                |
| correct\_answer         | TEXT                                      | æ­£ç¡®ç­”æ¡ˆ                                            |
| explanation             | TEXT (nullable=True)                      | ç­”æ¡ˆè§£æ                                            |
| question\_text          | TEXT (nullable=True)                      | å¸¦æœ‰ç©ºæ ¼çš„å¥å­åŸæ–‡ (ä¾‹å¦‚å¡«ç©ºé¢˜é¢˜å¹²)                         |
| translation\_text       | TEXT (nullable=True)                      | éœ€è¦ç¿»è¯‘çš„åŸæ–‡ (é€šå¸¸æ˜¯å®Œæ•´å¥å­)                           |
| translation\_options    | JSON (nullable=True)                      | ç¿»è¯‘é¢˜é€‰é¡¹ (ä¸­æ–‡)                                     |
| correct\_translation    | TEXT (nullable=True)                      | æ­£ç¡®çš„ç¿»è¯‘ç­”æ¡ˆ                                        |
| difficulty              | String(50) (nullable=True)                | é¢˜ç›®éš¾åº¦                                            |
| knowledge\_point        | String(255) (nullable=True)               | çŸ¥è¯†ç‚¹                                             |
| order                   | Integer (default=1)                       | é¢˜ç›®åœ¨å¥å­ä¸­çš„é¡ºåº (ä¾‹å¦‚ï¼Œ1 for word_choice, 2 for translation) |

---

### 4. `user_answers` è¡¨ï¼šç”¨æˆ·ç­”é¢˜è®°å½•

| å­—æ®µ              | ç±»å‹                           | æè¿°                                   |
| ----------------- | ------------------------------ | -------------------------------------- |
| id                | Integer (autoincrement)        | ä¸»é”®                                   |
| user\_id          | UUID (nullable=True)           | ç”¨æˆ·å¤–é”® (å…è®¸åŒ¿åç”¨æˆ·çš„ç­”é¢˜è®°å½•)             |
| question\_id      | Integer (ForeignKey: questions.id) | é¢˜ç›®å¤–é”®                                 |
| selected\_answer  | TEXT                           | ç”¨æˆ·é€‰æ‹©çš„ç­”æ¡ˆ                             |
| is\_correct       | Boolean                        | æ˜¯å¦æ­£ç¡®                                 |
| answered\_at      | DateTime (timezone=True, server_default=now) | æ—¶é—´æˆ³                                  |

---

### 5. `user_vocab` è¡¨ï¼šç”¨æˆ·ç”Ÿè¯è¡¨

| å­—æ®µ           | ç±»å‹                                                           | æè¿°                        |
| ------------ | -------------------------------------------------------------- | ------------------------- |
| id           | Integer (autoincrement)                                        | ä¸»é”®                        |
| user\_id     | UUID (ForeignKey: users.id)                                    | ç”¨æˆ·å¤–é”®                      |
| word         | TEXT                                                           | ç”Ÿè¯                        |
| sentence\_id | Integer (ForeignKey: sentences.id, nullable=True)              | æ¥è‡ªå“ªä¸ªå¥å­ï¼ˆå¯è¿½è¸ªï¼‰               |
| status       | ENUM ('new', 'learning', 'mastered', default='new')            | å­¦ä¹ çŠ¶æ€                      |
| added\_at    | DateTime (timezone=True, server_default=now)                   | æ·»åŠ æ—¶é—´                      |

---

### 6. `user_mistakes` è¡¨ï¼šé”™é¢˜è®°å½•

| å­—æ®µ             | ç±»å‹                                                       | æè¿°                                              |
| -------------- | ---------------------------------------------------------- | ----------------------------------------------- |
| id             | Integer (autoincrement)                                    | ä¸»é”®                                              |
| user\_id       | UUID (ForeignKey: users.id)                                | ç”¨æˆ·å¤–é”®                                          |
| sentence\_id   | Integer (ForeignKey: sentences.id)                         | å“ªå¥è¯å‡ºé”™                                         |
| \_question\_id  | \_UUID (ForeignKey: questions.id)\_                        | \_å“ªé“é¢˜å‡ºé”™ (æ›´å…·ä½“ï¼Œå¯é€‰)\_                          |
| grammar\_point  | TEXT (nullable=True)                                       | å‡ºé”™è¯­æ³•ç‚¹ (å¯ä»å¥å­æˆ–é¢˜ç›®æ´¾ç”Ÿ)                             |
| \_user\_answer\_id | \_UUID (ForeignKey: user_answers.id, nullable=True)\_      | \_å…³è”åˆ°å…·ä½“çš„é”™è¯¯ç­”æ¡ˆ (å¯é€‰)\_                         |
| created\_at    | DateTime (timezone=True, server_default=now)               | é”™è¯¯è®°å½•æ—¶é—´                                        |

---

## ğŸ“¡ API è·¯ç”±è®¾è®¡ï¼ˆRESTfulï¼‰

### Auth æ¨¡å— (`/auth`)

| è·¯å¾„                  | æ–¹æ³•   | åŠŸèƒ½             | è¯·æ±‚ä½“ (Body) / ä¸»è¦å‚æ•° |
| --------------------- | ---- | ---------------- | -------------------- |
| `/register`           | POST | ç”¨æˆ·æ³¨å†Œ           | `email` (string), `password` (string) |
| `/login/token`        | POST | ç”¨æˆ·ç™»å½•ï¼Œè·å–Token   | `username` (string, å³email), `password` (string) - (form-data) |
| `/me`                 | GET  | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼ˆéœ€Tokenï¼‰ | æ—                    |

---

### ç»ƒä¹ æ¨¡å— (`/practice`)

| è·¯å¾„                        | æ–¹æ³•   | åŠŸèƒ½                                       | ä¸»è¦å‚æ•° / è¯·æ±‚ä½“ (Body) |
| --------------------------- | ---- | ------------------------------------------ | -------------------------- |
| `/cache/initialize`         | POST | åˆå§‹åŒ–ç”¨æˆ·é¢˜ç›®ç¼“å­˜æ±  (ç”¨æˆ·è®¿é—®æˆ–åˆ·æ–°é¡µé¢æ—¶è°ƒç”¨)                 | (éœ€Token) æ— Body |
| `/set/new`                  | GET  | è·å–æ–°ç»ƒä¹ é¢˜ (æ ¹æ®ä¸»é¢˜å’Œéš¾åº¦ï¼Œä»ç¼“å­˜æˆ–ç”Ÿæˆ)                 | (éœ€Token) `topic` (query, string, optional), `difficulty` (query, string, optional) |
| `/set/submit`               | POST | æäº¤ç»ƒä¹ ç­”æ¡ˆ                                   | (éœ€Token) Body: `List[UserAnswerCreate]` <br> `UserAnswerCreate`: `question_id` (int), `selected_answer` (string), `answered_at` (datetime, optional), `question_type` (string, optional) |
| `/question/{question_id}`   | GET  | è·å–ç‰¹å®šé—®é¢˜è¯¦æƒ…                                 | `question_id` (path, string) |
| `/history`                  | GET  | è·å–ç”¨æˆ·ç»ƒä¹ å†å²è®°å½• (åˆ†é¡µ)                            | `limit` (query, int, default 10), `offset` (query, int, default 0) |
| `/stats`                    | GET  | è·å–ç”¨æˆ·ç»ƒä¹ ç»Ÿè®¡ä¿¡æ¯                               | æ—  |

---

### ç”Ÿè¯æ¨¡å— (`/vocab`) (æ‰€æœ‰æ“ä½œéœ€Token)

| è·¯å¾„             | æ–¹æ³•   | åŠŸèƒ½             | ä¸»è¦å‚æ•° / è¯·æ±‚ä½“ (Body) |
| ---------------- | ---- | ---------------- | -------------------------- |
| `/`              | POST | æ·»åŠ ç”Ÿè¯åˆ°ç”¨æˆ·ç”Ÿè¯æœ¬    | Body: `UserVocabCreate` (`word`: string, `sentence_id`: int (optional)) |
| `/`              | GET  | è·å–ç”¨æˆ·ç”Ÿè¯åˆ—è¡¨ (åˆ†é¡µ) | `skip` (query, int, default 0), `limit` (query, int, default 100) |
| `/{vocab_id}`    | PUT  | æ›´æ–°ç”Ÿè¯çŠ¶æ€        | `vocab_id` (path, string), Body: `UserVocabUpdate` (`status`: VocabStatus (optional)) |
| `/{vocab_id}`    | DELETE | ä»ç”Ÿè¯æœ¬åˆ é™¤ç”Ÿè¯     | `vocab_id` (path, string) |

---

### é”™é¢˜æ¨¡å— (`/mistakes`) (æ‰€æœ‰æ“ä½œéœ€Token)

| è·¯å¾„                | æ–¹æ³•   | åŠŸèƒ½                      | ä¸»è¦å‚æ•° / è¯·æ±‚ä½“ (Body) |
| ------------------- | ---- | ------------------------- | -------------------------- |
| `/`                 | POST | æ·»åŠ é”™é¢˜è®°å½•                  | Body: `UserMistakeCreate` (`sentence_id`: int, `grammar_point`: string (optional)) |
| `/`                 | GET  | è·å–ç”¨æˆ·é”™é¢˜åˆ—è¡¨ (åˆ†é¡µ, å¯æŒ‰è¯­æ³•ç‚¹è¿‡æ»¤) | `skip` (query, int, default 0), `limit` (query, int, default 100), `grammar_point` (query, string, optional) |
| `/{mistake_id}`     | GET  | è·å–ç‰¹å®šé”™é¢˜è¯¦æƒ…                | `mistake_id` (path, string) |
| `/{mistake_id}`     | DELETE | åˆ é™¤é”™é¢˜è®°å½•                  | `mistake_id` (path, string) |

---

### è¯ä¹‰è§£é‡Šæ¨¡å—ï¼ˆè¯å…¸ï¼‰

| è·¯å¾„                  | æ–¹æ³•  | åŠŸèƒ½        |
| ------------------- | --- | --------- |
| `/dictionary/:word` | GET | è·å–å•è¯é‡Šä¹‰ã€ä¾‹å¥ |

> å¯æ¥æœ¬åœ°è¯åº“ JSON æˆ–é›†æˆè¯å…¸ APIï¼ˆå¦‚ Free Dictionary APIï¼‰

---

## ğŸ§  æ¨èç³»ç»Ÿé€»è¾‘ï¼ˆè¯­æ³•ç‚¹æ‹“å±•ï¼‰

å½“ç”¨æˆ·ç­”é”™æŸä¸ªé¢˜ç›®æ—¶ï¼š

1. åç«¯æ ¹æ®è¯¥é¢˜å…³è”çš„ `grammar_point`
2. æŸ¥è¯¢è¯¥è¯­æ³•ç‚¹ä¸‹çš„å…¶å®ƒé¢˜ç›®ï¼ˆ`sentences` + `questions`ï¼‰
3. éšæœºæŒ‘é€‰ä¸¤ç»„ï¼Œä½œä¸ºæ¨èé¢˜è¿”å›

---

## ğŸ” å®‰å…¨æ€§å»ºè®®

* æ‰€æœ‰ç”¨æˆ·æ“ä½œéœ€ JWT é‰´æƒ
* å¯†ç ä½¿ç”¨ `bcrypt` åŠ å¯†
* è¯ä¹‰ç‚¹å‡»ä¸è®°å½•æ—¥å¿—ï¼Œç­”é¢˜ä¸ç”Ÿè¯æ·»åŠ è®°å½•å¯é™åˆ¶é¢‘ç‡ï¼ˆé˜²åˆ·ï¼‰

---

## ğŸ“¦ ç›®å½•ç»“æ„ï¼ˆFastAPI ç¤ºä¾‹ï¼‰

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ db.py
â”œâ”€â”€ tests/
â”œâ”€â”€ requirements.txt
â””â”€â”€ Dockerfile
```

---

## ğŸš€ æ‹“å±•å»ºè®®ï¼ˆå¯é€‰ï¼‰

* âœ… ç®¡ç†åå°ï¼ˆåŸºäº Supabase Studio æˆ– Admin Panelï¼‰
* âœ… ä½¿ç”¨ Prisma ORM ç®¡ç†æ•°æ®åº“ç»“æ„ï¼ˆNode.js é¡¹ç›®æ¨èï¼‰
* âœ… æœªæ¥å¯é›†æˆ AI è¾…åŠ©ç”Ÿè¯è§£é‡Š / è‡ªåŠ¨å‡ºé¢˜
